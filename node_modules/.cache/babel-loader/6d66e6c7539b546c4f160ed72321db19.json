{"ast":null,"code":"import { _CI, _HI, _M, _MCCC, _ME, _MFCC, _MP, _MR, EMPTY_OBJ, render, _RFC as renderFunctionalComponent } from 'inferno';\nimport { isFunction, isInvalid, isNull, isNullOrUndef, throwError } from './shared';\nfunction isSameInnerHTML(dom, innerHTML) {\n  var tempdom = document.createElement('i');\n  tempdom.innerHTML = innerHTML;\n  return tempdom.innerHTML === dom.innerHTML;\n}\nfunction findLastDOMFromVNode(vNode) {\n  var flags;\n  var children;\n  while (vNode) {\n    flags = vNode.flags;\n    if (flags & 2033 /* DOMRef */) {\n      return vNode.dom;\n    }\n    children = vNode.children;\n    if (flags & 8192 /* Fragment */) {\n      vNode = vNode.childFlags === 2 /* HasVNodeChildren */ ? children : children[children.length - 1];\n    } else if (flags & 4 /* ComponentClass */) {\n      vNode = children.$LI;\n    } else {\n      vNode = children;\n    }\n  }\n  return null;\n}\nfunction isSamePropsInnerHTML(dom, props) {\n  return Boolean(props && props.dangerouslySetInnerHTML && props.dangerouslySetInnerHTML.__html && isSameInnerHTML(dom, props.dangerouslySetInnerHTML.__html));\n}\nfunction hydrateComponent(vNode, parentDOM, dom, context, isSVG, isClass, lifecycle) {\n  var type = vNode.type;\n  var ref = vNode.ref;\n  var props = vNode.props || EMPTY_OBJ;\n  var currentNode;\n  if (isClass) {\n    var instance = _CI(vNode, type, props, context, isSVG, lifecycle);\n    var input = instance.$LI;\n    currentNode = hydrateVNode(input, parentDOM, dom, instance.$CX, isSVG, lifecycle);\n    _MCCC(ref, instance, lifecycle);\n  } else {\n    var _input = _HI(renderFunctionalComponent(vNode, context));\n    currentNode = hydrateVNode(_input, parentDOM, dom, context, isSVG, lifecycle);\n    vNode.children = _input;\n    _MFCC(vNode, lifecycle);\n  }\n  return currentNode;\n}\nfunction hydrateChildren(parentVNode, parentNode, currentNode, context, isSVG, lifecycle) {\n  var childFlags = parentVNode.childFlags;\n  var children = parentVNode.children;\n  var props = parentVNode.props;\n  var flags = parentVNode.flags;\n  if (childFlags !== 1 /* HasInvalidChildren */) {\n    if (childFlags === 2 /* HasVNodeChildren */) {\n      if (isNull(currentNode)) {\n        _M(children, parentNode, context, isSVG, null, lifecycle);\n      } else {\n        currentNode = hydrateVNode(children, parentNode, currentNode, context, isSVG, lifecycle);\n        currentNode = currentNode ? currentNode.nextSibling : null;\n      }\n    } else if (childFlags === 16 /* HasTextChildren */) {\n      if (isNull(currentNode)) {\n        parentNode.appendChild(document.createTextNode(children));\n      } else if (parentNode.childNodes.length !== 1 || currentNode.nodeType !== 3) {\n        parentNode.textContent = children;\n      } else if (currentNode.nodeValue !== children) {\n        currentNode.nodeValue = children;\n      }\n      currentNode = null;\n    } else if (childFlags & 12 /* MultipleChildren */) {\n      var prevVNodeIsTextNode = false;\n      for (var i = 0, len = children.length; i < len; ++i) {\n        var child = children[i];\n        if (isNull(currentNode) || prevVNodeIsTextNode && (child.flags & 16 /* Text */) > 0) {\n          _M(child, parentNode, context, isSVG, currentNode, lifecycle);\n        } else {\n          currentNode = hydrateVNode(child, parentNode, currentNode, context, isSVG, lifecycle);\n          currentNode = currentNode ? currentNode.nextSibling : null;\n        }\n        prevVNodeIsTextNode = (child.flags & 16 /* Text */) > 0;\n      }\n    }\n    // clear any other DOM nodes, there should be only a single entry for the root\n    if ((flags & 8192 /* Fragment */) === 0) {\n      var nextSibling = null;\n      while (currentNode) {\n        nextSibling = currentNode.nextSibling;\n        parentNode.removeChild(currentNode);\n        currentNode = nextSibling;\n      }\n    }\n  } else if (!isNull(parentNode.firstChild) && !isSamePropsInnerHTML(parentNode, props)) {\n    parentNode.textContent = ''; // dom has content, but VNode has no children remove everything from DOM\n    if (flags & 448 /* FormElement */) {\n      // If element is form element, we need to clear defaultValue also\n      parentNode.defaultValue = '';\n    }\n  }\n}\nfunction hydrateElement(vNode, parentDOM, dom, context, isSVG, lifecycle) {\n  var props = vNode.props;\n  var className = vNode.className;\n  var flags = vNode.flags;\n  var ref = vNode.ref;\n  isSVG = isSVG || (flags & 32 /* SvgElement */) > 0;\n  if (dom.nodeType !== 1) {\n    _ME(vNode, null, context, isSVG, null, lifecycle);\n    parentDOM.replaceChild(vNode.dom, dom);\n  } else {\n    vNode.dom = dom;\n    hydrateChildren(vNode, dom, dom.firstChild, context, isSVG, lifecycle);\n    if (!isNull(props)) {\n      _MP(vNode, flags, props, dom, isSVG);\n    }\n    if (isNullOrUndef(className)) {\n      if (dom.className !== '') {\n        dom.removeAttribute('class');\n      }\n    } else if (isSVG) {\n      dom.setAttribute('class', className);\n    } else {\n      dom.className = className;\n    }\n    _MR(ref, dom, lifecycle);\n  }\n  return vNode.dom;\n}\nfunction hydrateText(vNode, parentDOM, dom) {\n  if (dom.nodeType !== 3) {\n    parentDOM.replaceChild(vNode.dom = document.createTextNode(vNode.children), dom);\n  } else {\n    var text = vNode.children;\n    if (dom.nodeValue !== text) {\n      dom.nodeValue = text;\n    }\n    vNode.dom = dom;\n  }\n  return vNode.dom;\n}\nfunction hydrateFragment(vNode, parentDOM, dom, context, isSVG, lifecycle) {\n  var children = vNode.children;\n  if (vNode.childFlags === 2 /* HasVNodeChildren */) {\n    hydrateText(children, parentDOM, dom);\n    return children.dom;\n  }\n  hydrateChildren(vNode, parentDOM, dom, context, isSVG, lifecycle);\n  return findLastDOMFromVNode(children[children.length - 1]);\n}\nfunction hydrateVNode(vNode, parentDOM, currentDom, context, isSVG, lifecycle) {\n  var flags = vNode.flags |= 16384 /* InUse */;\n  if (flags & 14 /* Component */) {\n    return hydrateComponent(vNode, parentDOM, currentDom, context, isSVG, (flags & 4 /* ComponentClass */) > 0, lifecycle);\n  }\n  if (flags & 481 /* Element */) {\n    return hydrateElement(vNode, parentDOM, currentDom, context, isSVG, lifecycle);\n  }\n  if (flags & 16 /* Text */) {\n    return hydrateText(vNode, parentDOM, currentDom);\n  }\n  if (flags & 512 /* Void */) {\n    return vNode.dom = currentDom;\n  }\n  if (flags & 8192 /* Fragment */) {\n    return hydrateFragment(vNode, parentDOM, currentDom, context, isSVG, lifecycle);\n  }\n  throwError();\n  return null;\n}\nexport function hydrate(input, parentDOM, callback) {\n  var dom = parentDOM.firstChild;\n  if (isNull(dom)) {\n    render(input, parentDOM, callback);\n  } else {\n    var lifecycle = [];\n    if (!isInvalid(input)) {\n      dom = hydrateVNode(input, parentDOM, dom, {}, false, lifecycle);\n    }\n    // clear any other DOM nodes, there should be only a single entry for the root\n    while (dom && (dom = dom.nextSibling)) {\n      parentDOM.removeChild(dom);\n    }\n    if (lifecycle.length > 0) {\n      var listener;\n      while ((listener = lifecycle.shift()) !== undefined) {\n        listener();\n      }\n    }\n  }\n  parentDOM.$V = input;\n  if (isFunction(callback)) {\n    callback();\n  }\n}","map":null,"metadata":{},"sourceType":"module"}